<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mein DeutschBuddy</title>
<style>
  :root { --blue:#4461ff; --playing:#ffe9a8; }
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:#222;margin:0;padding:20px;text-align:center;
    background:linear-gradient(135deg,#eaf0ff 0%,#d5dcff 50%,#eef3ff 100%);
    min-height:100vh;
  }
  .bgglass{
    backdrop-filter:blur(8px) saturate(140%);
    -webkit-backdrop-filter:blur(8px) saturate(140%);
    background:rgba(255,255,255,.65);
    border-radius:16px;
    box-shadow:0 4px 14px rgba(0,0,0,.1);
    padding:20px;
    max-width:900px;margin:0 auto;
  }
  h1{color:var(--blue);margin:8px 0 4px}
  p.small{opacity:.75;margin:0 0 12px}
  textarea{width:100%;height:120px;border-radius:10px;border:2px solid var(--blue);
           padding:10px;font-size:16px;background:#fff;margin:6px 0}
  .controls{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:10px 0 6px}
  .btn{background:var(--blue);color:#fff;border:none;border-radius:10px;padding:10px 16px;
       font-weight:700;cursor:pointer}
  .btn.alt{background:#6b7cff}
  .status{font-size:.9rem;opacity:.8;min-height:1.2em;margin:4px 0 8px}
  .card{background:#fff;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1);
        padding:14px;margin:12px auto;text-align:left}
  .line{padding-left:10px;margin:6px 0;border-left:6px solid #999}
  .line.de{border-color:var(--blue)}
  .card.playing{background:var(--playing)}
  .pillbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .pill{background:#eef2ff;border:1px solid var(--blue);color:var(--blue);
        border-radius:999px;padding:6px 10px;font-weight:700;cursor:pointer;user-select:none}
  .pill.toggle.active{background:var(--blue);color:#fff}
  .panel{display:flex;flex-wrap:wrap;gap:14px;justify-content:center;align-items:center;margin:10px 0}
  .group{background:#fff;border:1px solid #cdd3ff;border-radius:12px;padding:8px 12px;
         display:flex;align-items:center;gap:10px}
  .group label{font-weight:700;color:#344}
  input[type=range]{accent-color:var(--blue)}
  .value{min-width:2.5ch;text-align:right;font-variant-numeric:tabular-nums}
  #modeTag{display:none;background:var(--blue);color:#fff;padding:6px 14px;
           border-radius:999px;font-weight:600;margin:10px auto;width:max-content}
</style>
</head>
<body>
<div class="bgglass">
  <h1>Mein DeutschBuddy üíô</h1>
  <p class="small">Paste German & English ‚Üí <b>Show</b>.  
  Or directly use <b>German-only (auto)</b> to hear only German sentences.</p>

  <textarea id="deInput" placeholder="üá©üá™ German sentences here..."></textarea>
  <textarea id="enInput" placeholder="üá¨üáß English translations here..."></textarea>

  <div class="controls">
    <button id="btnShow" class="btn">Show</button>
    <button id="btnPlay" class="btn">‚ñ∂ Play (DE‚ÜíEN)</button>
    <button id="btnGermanOnly" class="btn">‚ñ∂ German-only (auto)</button>
    <button id="btnStop" class="btn alt">‚èπ Stop</button>
    <button id="btnRestart" class="btn alt">‚èÆ Restart</button>
  </div>

  <div class="panel">
    <div class="group">
      <label for="deRate">DE speed</label>
      <input id="deRate" type="range" min="0.4" max="1.2" step="0.05" value="0.75">
      <span class="value" id="deRateVal">0.75</span>
    </div>
    <div class="group">
      <label for="enRate">EN speed</label>
      <input id="enRate" type="range" min="0.5" max="1.3" step="0.05" value="0.85">
      <span class="value" id="enRateVal">0.85</span>
    </div>
    <div class="group">
      <label>Repeats</label>
      <button class="pill toggle" data-repeats="2">x2</button>
      <button class="pill toggle" data-repeats="3">x3</button>
      <button class="pill toggle" data-repeats="4">x4</button>
    </div>
  </div>

  <div id="modeTag">üá©üá™ German-only mode active</div>
  <div id="status" class="status"></div>
  <div id="list"></div>
</div>

<script>
'use strict';
let currentIndex=0,autoMode=false,germanOnlyMode=false,lastStoppedIndex=0,hasUserGesture=false,speaking=false,playId=0;
let deRate=0.75,enRate=0.85,repeats=2;
const $=s=>document.querySelector(s);const listEl=$('#list');const statusEl=$('#status');
function setStatus(m){statusEl.textContent=m||'';}
function splitSentences(t){const p=(t||'').replace(/\s+/g,' ').trim().match(/[^.!?]+[.!?]?/g)||[];return p.map(s=>s.trim()).filter(Boolean);}
function buildPairs(){const de=splitSentences($('#deInput').value);const en=splitSentences($('#enInput').value);
 const len=Math.max(de.length,en.length),pairs=[];for(let i=0;i<len;i++)pairs.push({de:de[i]||'',en:en[i]||''});return pairs;}
function stopSpeaking(save=true){autoMode=false; speaking=false; playId++; germanOnlyMode=false;
 const s=window.speechSynthesis; try{s.cancel();setTimeout(()=>s.cancel(),50);}catch{} if(save)lastStoppedIndex=currentIndex;
 listEl.querySelectorAll('.playing').forEach(c=>c.classList.remove('playing')); setStatus('Stopped.');}
function speak(t,l,r,onend){if(!('speechSynthesis'in window))return;
 if(!hasUserGesture){setStatus('Tap any button once, then Play.');return;}
 const id=playId; if(!t){onend&&onend();return;}
 const u=new SpeechSynthesisUtterance(t);u.lang=l;u.rate=r;
 u.onend=()=>{if(id===playId)onend&&onend();};window.speechSynthesis.speak(u);}
function playPairWithRepeats(p,done){let c=0;const step=()=>{if(c>=repeats){done&&done();return;}
 speak(p.de,'de-DE',deRate,()=>{speak(p.en,'en-US',enRate,()=>{c++;step();});});};step();}
function playNext(){if(!autoMode)return;const pairs=buildPairs();
 if(currentIndex>=pairs.length){autoMode=false;setStatus('Finished.');return;}
 const pair=pairs[currentIndex]; if(!pair.de&&!pair.en){currentIndex++;playNext();return;}
 setStatus(`Playing ${currentIndex+1}/${pairs.length}`); listEl.querySelectorAll('.card').forEach(c=>c.classList.remove('playing'));
 const card=listEl.querySelector(`[data-idx="${currentIndex}"]`); if(card)card.classList.add('playing');
 if(germanOnlyMode){let c=0;const loop=()=>{if(!autoMode)return;if(c>=repeats){currentIndex++;playNext();return;}
 speak(pair.de,'de-DE',deRate,()=>{c++;loop();});};loop();}
 else{playPairWithRepeats(pair,()=>{if(!autoMode)return;currentIndex++;playNext();});}}
function playAll(){stopSpeaking(false);currentIndex=lastStoppedIndex||0;germanOnlyMode=false;autoMode=true;playNext();}
function playAllGerman(){stopSpeaking(false);currentIndex=lastStoppedIndex||0;germanOnlyMode=true;autoMode=true;playNext();}
function restartAll(){stopSpeaking(false);currentIndex=0;lastStoppedIndex=0;autoMode=true;playNext();}
function playFrom(i,g=false){stopSpeaking(false);currentIndex=i;germanOnlyMode=g;autoMode=true;playNext();}
function renderList(){const pairs=buildPairs();listEl.innerHTML='';
 pairs.forEach((p,i)=>{if(!p.de&&!p.en)return;const c=document.createElement('div');c.className='card';c.dataset.idx=i;
 const lDe=document.createElement('div');lDe.className='line de';lDe.textContent=`üá©üá™ ${p.de}`;c.appendChild(lDe);
 if(!germanOnlyMode){const lEn=document.createElement('div');lEn.className='line';lEn.textContent=`üá¨üáß ${p.en}`;c.appendChild(lEn);}
 listEl.appendChild(c);});setStatus(`Loaded ${buildPairs().length} sentence(s).`);}
$('#btnShow').addEventListener('click',()=>{hasUserGesture=true;$('#enInput').style.display='';$('#modeTag').style.display='none';renderList();});
$('#btnPlay').addEventListener('click',()=>{hasUserGesture=true;playAll();});
$('#btnGermanOnly').addEventListener('click',()=>{hasUserGesture=true;
  $('#enInput').style.display='none';$('#modeTag').style.display='block';renderList();playAllGerman();});
$('#btnStop').addEventListener('click',()=>{hasUserGesture=true;$('#modeTag').style.display='none';stopSpeaking();});
$('#btnRestart').addEventListener('click',()=>{hasUserGesture=true;restartAll();});
const deR=$('#deRate'),enR=$('#enRate');const deV=$('#deRateVal'),enV=$('#enRateVal');
function upd(){deV.textContent=deRate.toFixed(2);enV.textContent=enRate.toFixed(2);}
deR.addEventListener('input',e=>{deRate=+e.target.value;upd();});
enR.addEventListener('input',e=>{enRate=+e.target.value;upd();});upd();
document.querySelectorAll('.pill.toggle').forEach(b=>b.addEventListener('click',()=>{hasUserGesture=true;
repeats=+b.dataset.repeats;document.querySelectorAll('.pill.toggle').forEach(x=>x.classList.toggle('active',+x.dataset.repeats===repeats));}));
setRepeats?.(2);
document.addEventListener('pointerdown',()=>{hasUserGesture=true;},{once:true});
</script>
</body>
</html>
    
