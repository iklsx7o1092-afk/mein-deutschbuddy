<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mein DeutschBuddy</title>
<style>
  body{font-family:system-ui,Arial,sans-serif;background:#f3f5ff;color:#222;margin:0;padding:20px;text-align:center}
  h1{color:#4461ff;margin-bottom:6px}
  textarea{width:100%;height:120px;margin:8px 0;border:2px solid #4461ff;border-radius:8px;padding:8px;font-size:16px}
  .controls{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:12px 0}
  button{background:#4461ff;color:#fff;border:none;border-radius:8px;padding:10px 16px;font-weight:600;cursor:pointer}
  button.alt{background:#6b7cff}
  .status{min-height:1.2em;margin:6px 0;font-size:.9rem;opacity:.8}
  .card{background:#fff;border:1px solid #ddd;border-radius:8px;padding:10px;margin:8px auto;text-align:left;max-width:800px}
  .card.playing{background:#ffe9a8}
  .line{padding-left:10px;margin:4px 0;border-left:5px solid #999}
  .line.de{border-color:#4461ff}
  .panel{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:12px}
  .group{background:#fff;border:1px solid #cdd3ff;border-radius:10px;padding:6px 10px;display:flex;align-items:center;gap:8px}
  label{font-weight:600}
  input[type=range]{accent-color:#4461ff}
  .pill{background:#eef2ff;border:1px solid #4461ff;color:#4461ff;border-radius:999px;padding:4px 10px;font-weight:600;cursor:pointer}
  .pill.active{background:#4461ff;color:#fff}
  #modeTag{display:none;background:#4461ff;color:#fff;padding:6px 14px;border-radius:999px;font-weight:600;margin:8px auto;width:max-content}
</style>
</head>
<body>
  <h1>Mein DeutschBuddy üíô</h1>
  <p>Almanca & ƒ∞ngilizce c√ºmlelerini yaz, dinle ve pratik yap üéß</p>

  <textarea id="deInput" placeholder="üá©üá™ German sentences..."></textarea>
  <textarea id="enInput" placeholder="üá¨üáß English translations..."></textarea>

  <div class="controls">
    <button id="btnShow">Show</button>
    <button id="btnPlay">‚ñ∂ Play (DE‚ÜíEN)</button>
    <button id="btnGermanOnly">‚ñ∂ German-only (auto)</button>
    <button id="btnStop" class="alt">‚èπ Stop</button>
  </div>

  <!-- hƒ±z & tekrar paneli -->
  <div class="panel">
    <div class="group">
      <label>DE speed</label>
      <input id="deRate" type="range" min="0.4" max="1.3" step="0.05" value="0.8">
      <span id="deRateVal">0.8</span>
    </div>
    <div class="group">
      <label>EN speed</label>
      <input id="enRate" type="range" min="0.4" max="1.3" step="0.05" value="0.9">
      <span id="enRateVal">0.9</span>
    </div>
    <div class="group">
      <label>Repeats</label>
      <button class="pill" data-r="2">x2</button>
      <button class="pill" data-r="3">x3</button>
      <button class="pill" data-r="4">x4</button>
    </div>
  </div>

  <div id="modeTag">üá©üá™ German-only mode active</div>
  <div id="status" class="status"></div>
  <div id="list"></div>

<script>
'use strict';
let currentIndex=0,autoMode=false,germanOnlyMode=false,hasGesture=false;
let deRate=0.8,enRate=0.9,repeats=2;
const $=s=>document.querySelector(s),listEl=$('#list'),statusEl=$('#status');

function setStatus(t){statusEl.textContent=t||'';}
function split(txt){return (txt||'').replace(/\s+/g,' ').trim().match(/[^.!?]+[.!?]?/g)||[];}
function buildPairs(){
  const de=split($('#deInput').value),en=split($('#enInput').value);
  const n=Math.max(de.length,en.length);
  return Array.from({length:n},(_,i)=>({de:de[i]||'',en:en[i]||''}));
}

function speak(text,lang,rate,onend){
  if(!text){onend&&onend();return;}
  const u=new SpeechSynthesisUtterance(text);
  u.lang=lang;u.rate=rate;u.onend=()=>onend&&onend();
  speechSynthesis.speak(u);
}

function stopAll(){
  speechSynthesis.cancel();
  autoMode=false;
  setStatus('Stopped.');
  listEl.querySelectorAll('.card').forEach(c=>c.classList.remove('playing'));
}

function renderList(){
  const pairs=buildPairs();
  listEl.innerHTML='';
  pairs.forEach((p,i)=>{
    if(!p.de&&!p.en)return;
    const c=document.createElement('div');
    c.className='card';c.dataset.idx=i;
    const l=document.createElement('div');
    l.className='line de';l.textContent='üá©üá™ '+p.de;c.appendChild(l);
    if(!germanOnlyMode){
      const e=document.createElement('div');
      e.className='line';e.textContent='üá¨üáß '+p.en;c.appendChild(e);
    }
    listEl.appendChild(c);
  });
}

function playGermanOnly(){
  const pairs=buildPairs();autoMode=true;germanOnlyMode=true;currentIndex=0;
  function next(){
    if(!autoMode)return;
    if(currentIndex>=pairs.length){setStatus('Finished.');autoMode=false;return;}
    const p=pairs[currentIndex];
    listEl.querySelectorAll('.card').forEach(c=>c.classList.remove('playing'));
    const card=listEl.querySelector(`[data-idx="${currentIndex}"]`);
    if(card)card.classList.add('playing');
    setStatus(`Playing ${currentIndex+1}/${pairs.length}`);
    let r=0;
    const loop=()=>{
      if(r>=repeats){currentIndex++;next();return;}
      speak(p.de,'de-DE',deRate,()=>{r++;loop();});
    };
    loop();
  }
  next();
}

function playNormal(){
  const pairs=buildPairs();autoMode=true;germanOnlyMode=false;currentIndex=0;
  function next(){
    if(!autoMode)return;
    if(currentIndex>=pairs.length){setStatus('Finished.');return;}
    const p=pairs[currentIndex];
    listEl.querySelectorAll('.card').forEach(c=>c.classList.remove('playing'));
    const card=listEl.querySelector(`[data-idx="${currentIndex}"]`);
    if(card)card.classList.add('playing');
    let r=0;
    const seq=()=>{
      if(r>=repeats){currentIndex++;next();return;}
      speak(p.de,'de-DE',deRate,()=>{speak(p.en,'en-US',enRate,()=>{r++;seq();});});
    };
    seq();
  }
  next();
}

$('#btnShow').onclick=()=>{
  hasGesture=true;
  $('#enInput').style.display='';
  $('#modeTag').style.display='none';
  germanOnlyMode=false;
  renderList();
};
$('#btnPlay').onclick=()=>{
  hasGesture=true;
  speechSynthesis.cancel();
  germanOnlyMode=false;
  renderList();
  playNormal();
};
$('#btnGermanOnly').onclick=()=>{
  hasGesture=true;
  speechSynthesis.cancel();
  $('#enInput').style.display='none';
  $('#modeTag').style.display='block';
  germanOnlyMode=true;
  renderList();
  setTimeout(()=>playGermanOnly(),200);
};
$('#btnStop').onclick=()=>{stopAll();$('#modeTag').style.display='none';};

// hƒ±z sliderlarƒ±
const deR=$('#deRate'),enR=$('#enRate'),deV=$('#deRateVal'),enV=$('#enRateVal');
function upd(){deV.textContent=deRate.toFixed(2);enV.textContent=enRate.toFixed(2);}
deR.oninput=e=>{deRate=+e.target.value;upd();};
enR.oninput=e=>{enRate=+e.target.value;upd();};
upd();

// tekrar se√ßimi
document.querySelectorAll('.pill').forEach(b=>{
  b.onclick=()=>{
    repeats=+b.dataset.r;
    document.querySelectorAll('.pill').forEach(x=>x.classList.toggle('active',+x.dataset.r===repeats));
  };
});
document.querySelector('.pill[data-r="2"]').classList.add('active');
document.addEventListener('pointerdown',()=>{hasGesture=true;},{once:true});
</script>
</body>
</html>
